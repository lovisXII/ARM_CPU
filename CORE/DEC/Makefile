# Makefile automatically generated by ghdl
# Version: GHDL 0.37 (Ubuntu 0.37+dfsg-1ubuntu1) [Dunoon edition] - mcode code generator
# Command used to generate this makefile:
# ghdl --gen-makefile exec_tb
#export MBK_TARGET_LIB=/soc/alliance/cells/sxlib/
BUILD=../../work

MBK_TARGET_LIB?=/home/timo/Documents/Cours/alliance/alliance/src/cells/src/sxlib/
GHDL?=ghdl
GHDLFLAGS?=--workdir=$(BUILD)
GHDLRUNFLAGS?=
TB=decod_tb
COMPONENTS=decod
MODS=$(COMPONENTS) $(TB)

# Default target : elaborate
all : elab

# Elaborate target.
elab : analyse
		cd ../util && make analyse
		$(GHDL) -c $(GHDLFLAGS) -e $(TB)

.PHONY: run clean

# Run target
run : elab
		./$(TB)

# Targets to analyze libraries
analyse: $(addsuffix .vhdl,$(MODS))
		cd ../REG && make analyse
		cd ../util && make analyse
		$(GHDL) -a $(GHDLFLAGS) $^

clean:
		rm -f $(BUILD)/* *.vst *.vbe *.xsc *.o

synth: fifo_32b.vst decod_model.vst
	mkdir -p $(BUILD)/../synth
	cp *.vst $(BUILD)/../synth/.

fifo_32b.vbe: fifo_32b.vhdl
		vasy -I vhdl -V -o -p fifo_32b.vhdl fifo_32b

fifo_32b_o.vbe : fifo_32b.vbe
		boom -V fifo_32b fifo_32b_o

fifo_32b.vst : fifo_32b_o.vbe
		boog fifo_32b_o fifo_32b

decod.vst : decod.vhdl fifo_32b.vst reg.vst
		vasy -I vhdl -V -o -a -p	 decod.vhdl decod

decod_model_o.vbe : decod.vst
		boom -V -O decod_model decod_model_o

decod_model.vst : decod_model_o.vbe
		boog decod_model_o decod_model

reg.vst : ../REG/reg.vhdl ../REG/one_hot.vhdl
	make -C ../REG/ synth 
	cp $(BUILD)/../synth/reg.vst .